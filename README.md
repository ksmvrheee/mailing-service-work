## Введение

Проект представляет собой RestFUL API приложение, предназначенное для автоматизации отправки email-рассылок. В приложении реализованы такие функции, как:

1. Добавление, изменение и удаление адресатов рассылки в/из БД.
2. Добавление, планирование, запуск, остановка/удаление самих рассылок в/из БД.
3. Просмотр общей и частной статистики рассылок (количества отправленных и неотправленных сообщений).

Это учебный проект.

## Установка

После скачивания проекта необходимо разместить его в любом удобном каталоге на машине с установленным Python 3.

Далее возможны два варианта: установка необходимых для работы приложения библиотек непосредственно в базовый интерпретатор, либо создание виртуального окружения специально для проекта.

_Примечание: все дальнейшие консольные команды актуальны для машин под управлением Windows, однако варианты для Linux и Mac практически идентичны нижеприведённому, поэтому если вы знаете базовые команды терминала желаемой ОС, то скорее всего, вам не составит труда их повторить._

### Создание виртуального окружения (опционально)

Откройте терминал и перейдите в каталог mailing_service_work (это корневой каталог Django-проекта). Выполните следующую консольную команду:

    python -m venv <желаемое название виртуального окружения>

Теперь перейдите в папку с виртуальным окружением и активируйте скрипт _Activate_. Например:

    enviroment\Scripts\activate

Готово! Теперь вы используете виртуальное окружение, поэтому все устанавливаемые пакеты не будут включены в каталог библиотек вашего интерпретатора.

Чтобы деактивировать виртуальное окружение, выполните следующую команду:

    deactivate

## Установка необходимых пакетов

Теперь выполните следующую команду, чтобы установить пакеты, приведённые в файле requirements.txt:

    pip install -r requirements.txt

Дождитесь окончания установки. Если всё прошло хорошо, можно переходить к созданию локальной базы данных.

## Создание локальной БД

Данный проект использует простую и лёгкую БД SQLite. Данная база данных представляет собой единственный файл, и располагаться он будет здесь же — в корневом каталоге Django-проекта. Для создания БД необходимо записать и провести миграции. Нужно прописать следующую команду в терминале:

    python manage.py makemigrations mailing_service

Данная команда _создаст_ миграции для приложения mailing_service, которое является основным приложением данного проекта. Теперь необходимо _провести_ миграции. Для этого в терминале нужно прописать следующую команду:

    python manage.py migrate

## Запуск сервера

База данных создана. Можно переходить к запуску сервера. В случае, если приложение планируется запускать лишь на локальной машине, вполне можно обойтись без настройки IP хоста, т.к. по умолчанию это 127.0.0.1:8000, но если требуется развернуть приложение на другом IP, то необходимо добавить его в текстовом формате в список ALLOWED_HOSTS модуля настроек проекта, который расположен по пути:

    ../mailing-service-work/mailing_service_work/mailing_service_work/settings.py

Например:

    ALLOWED_HOSTS = ['www.examle.com',]

Для непосредственно запуска сервера требуется прописать в терминале следующее:

    python manage.py runserver

После запуска сервера можно переходить к использованию приложения.

## Заполнение данных для аутентификации

В файл _secret.txt_ следует разместить данные электронной почты, с которой будет осуществлена рассылка в формате:

    smtp-server: <адрес SMTP-сервера>
    port: <порт SMTP-сервера>
    email: <EMAIL>
    password: <пароль>

Эти данные будут использованы для аутентификации электронной почты внутри приложения. Именно через этот emai будут осуществляться рассылки.

Стоит заметить, что _подойдёт только SMTP-сервер, защищённый через SSL_ (однако найти такой не составит труда).

## Использование приложения

Для начала следует добавить какое-либо количество клиентов-получателей рассылок и сами рассылки. Сделать это можно как классическим взаимодействием с БД, так и средствами приложения.

Пользователь может добавлять в БД с непосредственно с помощью запросов к серверу следующие две сущности: Клиент и Рассылка. Ниже приведены шаблоны JSON-запросов для создания/изменения каждой из них:

Клиент:

    {
        "name": <Имя клиента>,
        "personal_email": <Email клиента>,
        "tag": <Метка клиента>
    }

Пример отправки запроса с данными реального клиента:

    {
        "name": "Иванов Иван Иванович",
        "personal_email": "for@example.com",
        "tag": "primary client"
    }

Рассылка:

    {
        launch_datetime": <Дата и время начала рассылки в формате yyyy-mm-dd hh:mm:ss>,
        "finish_datetime": <Дата и время конца рассылки в формате yyyy-mm-dd hh:mm:ss>,
        "text": <Текст рассылки>,
        "subject": <Тема рассылки>,
        "customer_tag": <Метка целевых клиентов>
    }

Пример отправки запроса с данными реальной рассылки:

    {
        launch_datetime": "2025-12-31 12:00:00",
        "finish_datetime": "2025-12-31 12:30:00",
        "text": "Зравствуйте, {name}!\nПоздравляем Вас с наступающими праздниками!",
        "subject": Поздравляем, {name}!,
        "customer_tag": "primary client"
    }

Как можно заметить, в тексте и теме письма можно использовать переменную {name} для вставки имени клиента. Впрочем, это необязательно.

Ниже приведён полный список предусмотренных http-запросов к серверу.

```<адрес сервера>/api/v1/customer/```:
1. POST-запрос с условленным JSON в body: добавление клиента.

```<адрес сервера>/api/v1/customer/<id Клиента>/```:
1. GET-запрос без JSON — просмотр сведений о клиенте;
2. PUT-запрос с условленным JSON — изменение данных клиента;
3. PATCH-запрос с условленным JSON — изменение данных клиента;
4. DELETE-запрос без JSON — удаление клиента из БД;

```<адрес сервера>/api/v1/mailing/```:
1. POST-запрос с условленным JSON в body: добавление рассылки.

```<адрес сервера>/api/v1/mailing/<id Рассылки>/```:
1. GET-запрос без JSON: просмотр сведений о рассылке;
2. PUT-запрос с условленным JSON — изменение данных рассылки;
3. PATCH-запрос с условленным JSON — изменение данных рассылки;

```<адрес сервера>/api/v1/mailing_statistic/```:
1. GET-запрос без JSON: просмотр общей статистики рассылок;

```<адрес сервера>/api/v1/mailing_statistic/<id Рассылки>/```:
1. GET-запрос без JSON: просмотр статистики конкретной рассылки;

```<адрес сервера>/api/v1/mailing_start/<id Рассылки>/```:
1. POST-запрос без JSON: запуск рассылки;

```<адрес сервера>/api/v1/mailing_delete/<id Рассылки>/```:
1. DELETE-запрос без JSON: удаление/остановка рассылки;

### Заключение

Теперь, зная, как создавать запросы к серверу, можно клиентским образом добавлять данные в БД, запускать и удалять рассылки. Хотя такое приложение предназначено скорее для использования в других фреймворках как инструмент автоматизации, при необходимости его можно использовать и в частном порядке.

Спасибо за внимание!